<!DOCTYPE html>
<html>
  <head>
    <title>Functional PHP</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- jQuery + history plugin -->
    <script type="text/javascript" src="src/jquery.min.js"></script>
    <script type="text/javascript" src="src/jquery.history.js"></script>

    <!-- Slippy core js file -->
    <script type="text/javascript" src="src/slippy.js"></script>

    <!-- Slippy structural styles -->
    <link type="text/css" rel="stylesheet" href="src/slippy.css"/>

    <!-- Slippy theme (feel free to change it) -->
    <link type="text/css" rel="stylesheet" href="src/slippy-pure.css"/>

    <!-- Specific styles for this presentation -->
    <link type="text/css" rel="stylesheet" href="fphp.css"/>

    <!-- Syntax highlighting core file  -->
    <script type="text/javascript" src="src/highlighter/shCore.js"></script>

    <!-- Syntax highlighting brushes, this one is only for javascript -->
    <script type="text/javascript" src="src/highlighter/shBrushPhp.js"></script>
    <script type="text/javascript" src="src/highlighter/shBrushPlain.js"></script>
    <script type="text/javascript" src="src/highlighter/shBrushJScript.js"></script>

    <!-- Syntax highlighting core CSS and a theme -->
    <link type="text/css" rel="stylesheet" href="src/highlighter/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="src/highlighter/shThemeEclipse.css"/>

    <script type="text/javascript">
      $(function() {
          $(".slide").slippy({
            animLen: 0,
            margin: 0.05
          });
          SyntaxHighlighter.all();
      });
    </script>

  </head>
  <body>

<section class="slide" id="session-title">
  <div class="vcenter">
    <h1>Functional PHP</h1>
    <h2>by Larry Garfield</h2>
  </div>
</section>

<div class="footer">
  <span class="right"><a href="http://www.garfieldtech.com/">http://www.garfieldtech.com/</a></span>
  <span style="text-align: center">DrupalCon Munich 2012</span>
  <span class="left"><a href="http://munich2012.drupal.org/">http://munich2012.drupal.org/</a></span>
  <hr class="defloat" />
</div>

<section class="slide">
  <h1>@Crell</h1>
  <div style="width: 50%; float: right; ">
    <img style="max-width: 100%; height: auto;" src="images/crell-nerf.jpg" />
  </div>

  <ul>
    <li>Senior Architect, Palantir.net</li>
    <li>Drupal Association Advisor</li>
    <li>Web Services & Context Initiative Owner</li>
    <li>Co-Author,<br /><em>Drupal 7 Module Development</em>,<br />Packt Publishing</li>
    <li>Architectural Gadfly</li>
    <li>Nerf Gunslinger</li>
  </ul>

  <img style="margin-top: 2em;" src="images/palantir.png" />
</section>

<section class="slide">
  <h1>What we do</h1>
  <img style="position: absolute; top: 30px; left: -100px;" src="images/sites/barnard-1.jpg" />
  <img style="position: absolute; top: 60px; left: -70px;" class="incremental" src="images/sites/foreign-affairs-1.jpg" />
  <img style="position: absolute; top: 90px; left: -40px;" class="incremental" src="images/sites/fieldmuseum-1.jpg" />
  <img style="position: absolute; top: 120px; left: -10px;" class="incremental" src="images/sites/opensource-1.jpg" />
  <img style="position: absolute; top: 150px; left: 20px;" class="incremental" src="images/sites/marketplace-1.jpg" />
</section>


<div style="display:none">
Functional Programming

    Warning: Hard core nerd action. Please bear with me.
    History
        Von Neumann Architecture
            Imperative programming (and Procedural)
        Jon Bakus
            FORTRAN
            1977 paper
    Concepts (Jr version)
        Algorithm First
            Baking a cake
        First-class function: Functions can be a variable
        Higher-order function: Function that operates on a Function
        Immutability
        No side-effects
    Benefits of Functional Thinking
        Algorithm, not Recipe
        Immutability == Testability
        Stateless == Fewer variables to keep track of
    Drawbacks
        State is useful!
        Algorithms are complicated
    PHP 5.3 Closures
        Describe PHP Anonymous functions / Closures
        __invoke()
    Stateless Programming
        Impossible in PHP/Drupal. But separate I/O from logic.
    Anonymous Functions as Callbacks
    Map (array_map())
    Filtering (array_filter())
    Reducing (array_reduce())
    Currying
        Haskell Curry (name means nothing!)
        Partial implementation of a function
</div>

<section class="slide">
  <div class="vcenter">
    <h1>Warning, hard core geek action</h1>
    <h2>Please pardon the nerd</h2>
  </div>
  Picture: something nerdy? Steal from Webchick.
</section>

<section class="slide" data-background="images/drupal-delorean.jpg" data-credit="http://webchick.net/drupal-8-slides">
  <h1 style="position: absolute; bottom: 1em; left: 3em; color: White;">But first, a little history...</h1>
</section>

<section class="slide">
  <h1>Von Neumann Architecture</h1>
  <div style="width: 50%; float: right; border: 1px;">
    <img style="max-width: 80%; max-height: 80%;" src="images/john-von-neumann.gif" data-credit="http://en.wikipedia.org/wiki/File:JohnvonNeumann-LosAlamos.gif" />
  </div>

  <ul>
    <li><a href="http://en.wikipedia.org/wiki/John_von_Neumann">John Von Neumann</a>, 1903-1957</li>
    <li class="incremental">Mathematician, Physicist, all-around genius</li>
    <li class="incremental">Set theory, Operator theory, quantum theory, nuclear physics...</li>
    <li class="incremental">One of those ridiculously smart people who don't get enough credit for how much they change the world.</li>
  </ul>
</section>

<section class="slide">
  <h1>Von Neumann Architecture</h1>
  <div style="text-align: center;"><img src="images/Computer_system_bus.svg" alt="Computer system bus" data-credit="http://en.wikipedia.org/wiki/File:Computer_system_bus.svg" /></div>
</section>

<section class="slide">
  <h1>Von Neumann Architecture</h1>
  <ol>
    <li class="incremental">A program is just data</li>
    <li class="incremental">A program is a series of steps</li>
    <li class="incremental">Steps execute in linear sequence</li>
    <li class="incremental">Steps can alter the next step</li>
    <li class="incremental">Modify memory registers ad infinitium</li>
  </ol>

  <h2 class="incremental" style="margin-top: 2em;">"Stored Program" concept</h2>
</section>

<section class="slide">
  <h1>Von Neumann Architecture</h1>
  <div>Some graphic here for instructions executing</div>
</section>

<section class="slide">
  <h1>Imperative Programming</h1>
  <ul>
    <li class="incremental">Imperative "mood"</li>
    <li class="incremental">Series of precise commands</li>
    <li class="incremental">"State": values that get changed over time by commands</li>
    <li class="incremental">The purpose of commands is to alter state</li>
    <li class="incremental" style="margin-top: 2em;">This is what all modern hardware does</li>
  </ul>
</section>

<section class="slide">
  <div class="vcenter">
    <h2>Imperative Programming is following a recipe for a cake</h2>
  </div>
</section>

<section class="slide">
  <h1>Procedural Programming</h1>
  <ul>
    <li class="incremental">Imperative Programming: Evolved</li>
    <li class="incremental">Procedure = subroutine = reusable series of commands</li>
    <li class="incremental">Structured Programming: High-level abstractions
      <ul>
        <li><code>if-then</code></li>
        <li><code>while</code></li>
        <li><code>for</code></li>
      </ul>
    </li>
  </ul>

  <div class="incremental">
    <pre class="brush:plain">
    Var MyList [5, 7, 2, 9, 2]
    Var Biggest
    Procedure FindBiggest
      For MyList As Item
        If Item > Biggest Then
          Biggest = Item
        End If
      End For
      Return
    End Procedure

    Call FindBiggest
    Print Biggest
    </pre>
  </div>
</section>

<section class="slide">
  <div class="vcenter">
    <h2>Imperative Programming is following a recipe for a cake</h2>
    <br />
    <h2>Procedural Programming is singing a song with a refrain</h2>
  </div>
</section>

<section class="slide">
  <h1 class="vcenter">Imperative Programming defines <br /><em>how</em> a program should work.</h1>
</section>

<section class="slide">
  <h1 class="vcenter">Declarative Programming</h1>
</section>

<section class="slide">
  <h1 class="vcenter">Declarative Programming defines <br /><em>what</em> a program should accomplish.</h1>
</section>

<section class="slide">
  <h1>John Backus</h1>
  <div style="width: 50%; float: right; border: 1px;">
    <img style="max-width: 80%; max-height: 80%;" src="images/john-backus" data-credit="http://en.wikipedia.org/wiki/File:John_Backus.jpg" />
  </div>

  <ul>
    <li><a href="http://en.wikipedia.org/wiki/John_Backus">John Backus</a>, 1924-2007</li>
    <li class="incremental">Invented FORTRAN, 1953</li>
    <li class="incremental">As penance...
      <ul>
        <li class="incremental">Developed Backus-Naur Form (BNF)</li>
        <li class="incremental">Co-developed Algol</li>
        <li class="incremental">Function-level Programming (FP), 1977</li>
      </ul>
    </li>
  </ul>
  <p style="clear: both;" class="incremental">"Can Programming Be Liberated From the von Neumann Style? A Functional Style and its Algebra of Programs"</p>
</section>

<section class="slide">
  <h1>Functional Programming</h1>
  <h2 class="vcenter">Algorithm-first</h2>
</section>

<section class="slide">
  <h1>Functional Programming</h1>
  <div class="vcenter">
    <h2>Declare your algorithm</h2>
    <h2 style="margin-top: 2em;">The compiler optimizes for you</h2>
    <h2 style="margin-top: 2em;">"Functions" in the mathematical sense</h2>
  </div>
</section>

<section class="slide">
  <h1>Functional Programming</h1>
  <ul>
    <li class="incremental">Pure functions</li>
    <li class="incremental">Higher-order functions / First-class functions</li>
    <li class="incremental">Recursion</li>
  </ul>
</section>

<section class="slide">
  <h1>Pure functions</h1>
  <ul>
    <li class="incremental">No side-effects (including I/O)</li>
    <li class="incremental">Explicit function input/output</li>
    <li class="incremental">Stateless</li>
  </ul>
  <p>Example of pure function in PHP</p>
</section>

<section class="slide">
  <h1>Benefits</h1>
  <ul>
    <li class="incremental">Easy testability</li>
    <li class="incremental">Thread-safe</li>
    <li class="incremental">Self-evident</li>
    <li class="incremental">Memoizable</li>
  </ul>
</section>

<section class="slide">
  <h1>First-class functions</h1>
  <ul>
    <li class="incremental">Functions can be a variable</li>
    <li class="incremental">Functions can be a parameter</li>
    <li class="incremental">Functions can be a return type</li>
  </ul>
  <p>Example of first class anon function in PHP.</p>
</section>

<section class="slide">
  <h1>Benefits</h1>
  <ul>
    <li class="incremental">Strategy pattern</li>
    <li class="incremental">Partial evaluation / Currying</li>
    <li class="incremental">Lazy-evaluation</li>
  </ul>
</section>


<section class="slide">
  <h1>Recursion</h1>
  <ul>
    <li class="incremental">"To understand recursion you must first understand recursion."</li>
    <li class="incremental">Function that calls itself</li>
    <li class="incremental">Can replace loops</li>
  </ul>
  <p>Example of recursive function in PHP.</p>
</section>

<section class="slide">
  <h1>Benefits</h1>
  <ul>
    <li class="incremental">Divide-and-conquer</li>
    <li class="incremental">Stateless</li>
  </ul>
</section>

<section class="slide">
  <h1>Put it all together</h1>
  <p>Fibonacci sequence in PHP</p>
</section>

<section class="slide">
  <h1>Strictly functional languages</h1>
  <ul>
    <li class="incremental">ML</li>
    <li class="incremental">Haskell</li>
    <li class="incremental">Erlang</li>
    <li class="incremental">Many others...</li>
  </ul>
</section>

<section class="slide">
  <h1>Functional PHP</h1>
  <div class="vcenter">
    <h2>PHP lets you do all of that</h2>
    <h2 class="incremental" style="margin-top: 1em;">It just doesn't enforce it</h2>
    <h2 class="incremental" style="margin-top: 1em;">You can. You have the technology...</h2>
  </div>
</section>

<section class="slide">
  <h1 class="vcenter"><code>&lt;troll></code>PHP is as functional as LISP<code>&lt;/troll></code></h1>
</section>


<section class="slide">
  <h1>Anonymous functions</h1>
  <pre class="brush:php">
$find_pair = function ($card1, $card2) {
  return ($card1 == $card2);
};

$is_pair = $find_pair('2H', '8D');
  </pre>

  <div class="incremental">
    <div style="text-align: center;">==</div>
    <pre class="brush:php">
class FindPair {
  public function __invoke($card1, $card2) {
    return ($card1 == $card2);
  }
}

$find_pair = new FindPair();
$is_pair = $find_pair('2H', '8D');
    </pre>
  </div>
</section>


<section class="slide">
  <h1>Closures</h1>
  <pre class="brush:php">
$wild = '5H';
$find_pair = function ($card1, $card2) use ($wild) {
  return ($card1 == $card2 || $wild == $card1 || $wild == $card2);
};

$is_pair = $find_pair('2H', '8D');
  </pre>

  <div class="incremental">
    <div style="text-align: center;">==</div>
    <pre class="brush:php">
$wild = '5H';
class FindPair {
  protected $wild;

  public function __construct($wild) {
    $this->wild = $wild;
  }

  public function __invoke($card1, $card2) {
    return ($card1 == $card2
            || $this->wild == $card1
            || $this->wild == $card2);
  }
}

$find_pair = new FindPair($wild);
$is_pair = $find_pair('2H', '8D');

    </pre>
  </div>
</section>


<section class="slide">
  <h1>Delayed execution</h1>
  <pre class="brush:php">

class Container {
  protected $factories = array();

  public function __set($key, $func) {
    $this->factories[$key] = $func;
  }

  public function __get($key) {
    return $this->factories[$key]($this);
  }
}
  </pre>

  <div class="incremental">
    <pre class="brush:php">
$container = new Container();
$container->conn = function($c) {
  return new DatabaseConnection($c->conn_info);
};
$container->conn_info = array('user' => 'me', 'pass' => 'hi');

$conn = $container->conn;
$conn->query('...');

    </pre>
  </div>

  <h2 class="incremental">Hey, look, a Dependency Injection Container!</h2>

  <div style="text-align: center; margin-top: 2em;" class="incremental">See also: <a href="http://pimple.sensiolabs.org/">Pimple</a></div>
</section>


<section class="slide">
  <h1>Lexical scoping</h1>
  <h3>Lame...</h3>
  <pre class="brush:php">
function double($a) {
  return $a * 2;
}
function something_important(array $arr) {
  $arr = array_map('double', $arr);
  // ...
}
  </pre>

  <div class="incremental">
    <h3>Worse...</h3>
    <pre class="brush:php">
function multiply($a) {
  return $a * $GLOBALS['factor'];
}
function something_important(array $arr, $factor) {
  $GLOBALS['factor'] = $factor;
  $arr = array_map('multiply', $arr);
  // ...
}
    </pre>
  </div>

  <div class="incremental">
    <h3>Slick...</h3>
    <pre class="brush:php">
function something_important(array $arr, $factor) {
  $arr = array_map(function ($a) use ($factor) {
    return $a * $factor;
  }, $arr);
  // ...
}
    </pre>
  </div>

  <div style="text-align: center; margin-top: 1em;" class="incremental">Especially useful for <code>preg_replace_callback()</code></div>
</section>

<section class="slide" data-background="images/curry-food.jpg" data-credit="http://www.flickr.com/photos/hermitsmoores/4617145189">
  <h1 class="vcenter">Currying</h1>
</section>



<section class="slide">
  <h1>Haskell Curry</h1>
  <div style="text-align: center;">
    <img src="images/haskell-curry.jpg" alt="Haskell B. Curry" data-credit="http://www.haskell.org/haskellwiki/Haskell_Brooks_Curry" />
    <h3>1900 - 1982</h3>
    <h2><a href="http://en.wikipedia.org/wiki/Haskell_Curry">Yet another</a> crazy smart mathematician</h2>
  </div>
</section>


<section class="slide">
  <h1>Currying</h1>
  <div class="vcenter">
    <h2>Splitting a <a href="http://en.wikipedia.org/wiki/Currying">multi-parameter function</a><br />into multiple single-parameter functions</h2>
    <h2 style="margin-top: 2em;">A special case of partial-application</h2>
  </div>
</section>


<section class="slide">
  <h1>Partial-application</h1>
  <pre class="brush:php">
$add = function ($a, $b) {
  return $a + $b;
};
  </pre>

  <div class="incremental">
    <pre class="brush:php">
$add = function ($a) {
  return function($b) use ($a) {
    return $a + $b;
  };
};

$add1 = $add(1);
$add5 = $add(5);

$x = $add5($y);
    </pre>
  </div>

  <div class="incremental">
    <pre class="brush:php">
$add = function ($a) {
  return function($b) use ($a) {
    return $a + $b;
  };
};

$adder = $add(variable_get('increment_amount'));
$x = $adder($y);
    </pre>
  </div>
</section>


<section class="slide">
  <h1>Partial-application</h1>
  <pre class="brush:php">
$add = function ($a) {
  return function($b) use ($a) {
    return $a + $b;
  };
};

$adder = $add(variable_get('increment_amount'));

$values = array_map($adder, $array);
  </pre>
</section>


<section class="slide">
  <h1>Memoization</h1>
  <pre class="brush:php">
$factorial = function($a) use (&$factorial)  {
  print "Called function with $a" . PHP_EOL;
  if ($a == 1) {
    return 1;
  }
  return $a * $factorial($a - 1);
};

print "Result: " . $factorial(3) . PHP_EOL;
print "Result: " . $factorial(4) . PHP_EOL;
  </pre>

  <div class="incremental">
    <pre class="brush:php">
Called function with 3
Called function with 2
Called function with 1
Result: 6
Called function with 4
Called function with 3
Called function with 2
Called function with 1
Result: 24
    </pre>
  </div>
</section>


<section class="slide">
  <h1>Memoization</h1>
  <pre class="brush:php">
function memoize($function) {
  return function() use ($function) {
    static $results = array();
    $args = func_get_args();
    $key = serialize($args);
    if (empty($results[$key])) {
      $results[$key] = call_user_func_array($function, $args);
    }
    return $results[$key];
  };
}

$factorial = memoize($factorial);

print "Result: " . $factorial(3) . PHP_EOL;
print "Result: " . $factorial(4) . PHP_EOL;
  </pre>

  <div class="incremental">
    <pre class="brush:php">
Called function with 3
Called function with 2
Called function with 1
Result: 6
Called function with 4
Result: 24
    </pre>
  </div>
</section>

<section class="slide">
  <h1 class="vcenter">Pure functions are awesome!</h1>
</section>

<section class="slide">
  <h1 class="vcenter">You must separate your logic from your I/O!</h1>
</section>

<section class="slide">
  <h1 class="vcenter">You should be doing that anyway...</h1>
</section>

<section class="slide">
  <h1 class="vcenter">The Functional Way(tm)</h1>
</section>

<section class="slide">
  <h1>Map/Reduce</h1>
  <ul>
    <li class="incremental">"Embarrassingly Parallel" Problems</li>
    <li class="incremental">Map
      <ol>
        <li>Divide a problem into (identical) sub-problems</li>
        <li>Distribute to separate workers</li>
      </ol>
    </li>
    <li class="incremental">Reduce
      <ol>
        <li>Collect answers</li>
        <li>Combine back together</li>
      </ol>
    </li>
    <li class="incremental">Really useful for epically huge data sets</li>
  </ul>
</section>

<section class="slide">
  <h1>Map/Reduce</h1>
  <ul>
    <li class="incremental">Could get very complicated, or...</li>

    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      $result = array_map($callback, $array);

      $result = array_map(function($a) {
        // Your logic here.
      }, $array);

      $result = array_map(function($a, $b) {
        // Your logic here.
      }, $array1, $array2);
      </pre>
    </li>
    <li class="incremental"><code>foreach()</code>, but separates application from loop</li>
    <li class="incremental">Slightly slower, but not enough to care</li>
  </ul>
</section>

<section class="slide">
  <h1>Fold</h1>
  <ul>
    <li class="incremental">"Analyze a recursive data structure and recombine
      through use of a given combining operation the results of recursively
      processing its constituent parts, building up a return value." <address>--Wikipedia</address></li>
    <li class="incremental">Iterate over a list and turn it into a single result</li>

    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      $sum = sum([1, 2, 3, 4, 5]);
      </pre>
    </li>
    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      foreach ($array as $element) {
        $result = sum($result, $element);
      }
      </pre>
    </li>
    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      array_reduce($function, $array);

      $initial = array_shift($array);
      array_reduce($array, function ($result, $item) {
        return $result + $item;
      }, $initial);
      </pre>
    </li>
  </ul>
</section>

<section class="slide">
  <h1>Filter</h1>
  <ul>
    <li class="incremental">Reduce a dataset to relevant elements</li>
    <li class="incremental">Similar to Map (apply process to set in parallel)</li>

    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      $result = array_filter($array, $filter_function);
      </pre>
    </li>
    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      $array = [1, 2, 3, 4, 5, 6, 7];
      $result = array_filter($array, function ($val) {
        // Only odd numbers.
        return ($var & 1);
      });
      </pre>
    </li>
    <li class="incremental" style="list-style-type: none;">
      <pre class="brush:php">
      $array = [0, 4, -4, 'foo', FALSE, NULL];
      $result = array_filter($array);
      // [4, -4, 'foo']
      </pre>
    </li>
  </ul>
</section>

<section class="slide">
  <h1>The take aways...</h1>
  <ul>
    <li class="incremental">Pure functions are awesome... most of the time</li>
    <li class="incremental">Separate purity from impurity</li>
    <li class="incremental">Anonymous functions rock. Don't let anyone tell you different.</li>
    <li class="incremental">Think in logic, not state.</li>
  </ul>
</section>


<section class="slide">
  <h1 class="vcenter">Title</h1>
</section>

<section class="slide">
  <h1>Title</h1>
  <div class="incremental" style="float: left">
    <h2>Title</h2>
    <ul>
      <li></li>
      <li></li>
    </ul>
  </div>
  <div class="incremental" style="float: left">
    <h2>Title</h2>
    <ul>
      <li></li>
      <li></li>
    </ul>
  </div>

  <div style="clear: all">
  </div>
</section>

<section class="slide">
  <h1>Title</h1>
  <div>Description</div>

  <table class="visible" style="width: 100%; border: 1px solid black;">
    <thead>
      <tr><th>Method</th> <th>Path</th> <th>Accept header</th> <th>Result</th></tr>
    </thead>
    <tbody>
      <tr class="incremental"><td>GET</td> <td>node/1</td> <td>text/html</td> <td class="incremental"><strong>Node view page</strong></td></tr>
      <tr class="incremental"><td>GET</td> <td>node/1</td> <td>application/json</td> <td class="incremental"><strong>JSON-LD record</strong></td></tr>
      <tr class="incremental"><td>POST</td> <td>system/form/node_edit</td> <td>text/html</td> <td class="incremental"><strong>Submit a node form and redirect</strong></td></tr>
      <tr class="incremental"><td>PUT</td> <td>node/1</td> <td>application/json</td> <td class="incremental"><strong>Overwrite the node exactly</strong></td></tr>
    </tbody>
  </table>
</section>

<section class="slide">
  <h1 class="vcenter">Questions?</h1>
</section>

  </body>
</html>
